<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로드의 전술서:로그인</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/login.css" rel="stylesheet">
</head>
<body>

    <%- include('nav_and_banner.ejs', {page: 'login', nickname: data.nickname, notice:'2025.08.01 신규 캐릭터 [물]라플라스 추가 완료'}) %>

    <div class="my-modal-bg">
        <div class="pw-id-find-container bg-gray">
            <div class="tabs  d-flex">
                <button class="active">비밀번호 찾기</button>
                <button class="">아이디 찾기</button>
            </div>
            <form class="main-contents ">
                <div class="pw-find ">
                    <input type="hidden" name="which_find" value="password">
                    <h5>아이디</h5>
                    <input type="text" name="username" class="input-box mb-4" placeholder="현재 아이디를 입력하세요.">

                    <h5>이메일</h5>
                    <input type="text" name="email" class="input-box" placeholder="가입한 이메일을 입력해주세요.">
                    <p class="info-msg mt-3">이메일로 임시 비밀번호를 보내드립니다.</p>
                    <p class="fault-msg"></p>
                </div>
                <div class="id-find invisible">
                    <input type="hidden" name="which_find" value="id">
                    <h5>이메일</h5>
                    <input type="text" name="email" class="input-box" placeholder="가입한 이메일을 입력해주세요.">
                    <h5 class="mt-3">위 이메일로 가입한 아이디 목록</h5>
                    <div class="id-list bg-lightgray blue-scroll">
                        
                    </div>
                    <p class="fault-msg"></p>
                </div>

            </form>
            <div class="btns btn-shadow bg-basicdark">
                <button class="cancel btn-cut btn-white color-gray">취소</button>
                <button class="submit btn-cut btn-yellow color-white">찾기</button>
            </div>

        </div>
    </div>


    <div class="basic-page-design login-container shadow-basic">
        <form action="/login" class="login-form" method="POST">
            <h3 class="mb-5 text-center">LOGIN</h3>
            <p class="color-red fault-msg text-start">
                <%= error && error.length ? error[0] : "" %>
            </p>
            <input type="text" name="username" class="input-box mt-1 mb-3" placeholder="아이디">
            <div class="password-input">
                <input type="password" name="password"class="input-box" placeholder="비밀번호">
                <i class="pw-switch fa-solid fa-eye-slash"></i>
            </div>
            <label class="checkbox-container mt-3 mb-3 d-flex align-self-center">  
                <input type="checkbox" name="keep_login" class="basic-checkbox checkbox-none">
                <span class="checkbox-img"></span> <span class="ms-2">로그인 상태 유지</span>  
            </label>
            <div class="btn-shadow"> <input type="submit" name="" id="" value="로그인" class="basic-btn btn-cut btn-blue color-white"></div>
            <div class="mb-4 btn-shadow btn-link"> <a href="/login/register"  class="basic-btn btn-cut btn-yellow color-white">회원가입</a></div>
            
            <a href="#" class="find-btn color-black text-center">아이디/비밀번호 찾기 <i class="fa-solid fa-caret-right"></i></a>

            <div class="mt-4 btn-shadow btn-link"> <a href="/login/google" class="basic-btn btn-cut btn-white  color-black">
                <img src="https://www.gstatic.com/marketing-cms/assets/images/d5/dc/cfe9ce8b4425b410b49b7f2dd3f3/g.webp=s48-fcrop64=1,00000000ffffffff-rw" class="google-logo">&nbsp; 구글로 로그인
            </a></div>
            <div class="btn-shadow"> <a href="/login/naver" class="basic-btn btn-cut naverlogin-bg color-white">
                <img src="/sources/img/naver_login.png" class="naver-logo">&nbsp; 네이버로 로그인
            </a></div>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <script>
        $(".pw-switch").on('click', function(e){
            if($(this).hasClass('fa-eye')){
                $(this).removeClass('fa-eye');
                $(this).addClass('fa-eye-slash');
                $(this).siblings('input').attr('type', 'password');

            } else {
                $(this).removeClass('fa-eye-slash');
                $(this).addClass('fa-eye');
                $(this).siblings('input').attr('type', 'text');
            }
        })

        $(".find-btn").on("click", function(e){
            $(".my-modal-bg").fadeIn();
            $(".pw-id-find-container").fadeIn();

        })

        $(document).on('click', function(e){
        // 빈 곳 클릭하면 아이디/비번 찾기 꺼지기
        if(!$(e.target).closest(".find-btn").length>0
        && !$(e.target).closest(".pw-id-find-container").length>0
        ){
            $(".my-modal-bg").fadeOut();
            $(".pw-id-find-container").fadeOut();
        }
    });

        $(".pw-id-find-container .cancel").on("click", function(e){
            $(".my-modal-bg").fadeOut();
            $(".pw-id-find-container").fadeOut();
        })

        $(".pw-id-find-container .tabs button").on("click", function(e){
            $(this).addClass("active");
            $(this).siblings("button").removeClass("active");

            if($(this).text().includes("비밀번호")){
                $(".pw-id-find-container .main-contents .pw-find").removeClass("invisible");
                $(".pw-id-find-container .main-contents .id-find").addClass("invisible");
            } else{
                $(".pw-id-find-container .main-contents .pw-find").addClass("invisible");
                $(".pw-id-find-container .main-contents .id-find").removeClass("invisible");
            }
        })

        $(document).ready(function() {
            $(".pw-id-find-container .submit").on("click", function(e){
                e.preventDefault();
                
                let finding_div = $(".main-contents > div:not(.invisible)")
                $('.id-find .id-list').empty();
                $(".pw-id-find-container .fault-msg").text("")

                $.ajax({
                    url: `/login/find/${finding_div.children("input[name='which_find']").val()}?email=${finding_div.children("input[name='email']").val()}&username=${finding_div.children("input[name='username']").val()}`, 
                    method: 'GET', 
                    contentType: 'application/json',
                    data: JSON.stringify({ 
                    }),
                    
                    // 요청 성공 
                    success: function(res) {

                        if(res.status.includes('2')){
                            // 아이디 찾기일 경우 - 아이디 목록 업데이트
                            if(res.data.type == "username"){
                                for(let i=0; i<res.data.usernames.length; i++){
                                    $('.id-find .id-list').append(`<span> ${res.data.usernames[i].username} </span>`)
                                }
                                $(".pw-id-find-container .fault-msg").text("")
                            } else{
                                $(".my-modal-bg").fadeOut();
                                $(".pw-id-find-container").fadeOut();
                                alert(res.data.message);
                            }                            

                            // fault-msg 업데이트
                            $(".pw-id-find-container .fault-msg").text(res.data.message)

                            
                        } else{
                            $(".pw-id-find-container .fault-msg").text(res.message)
                            
                        }
                    },                        
                    
                    error: function(xhr, status, error) {
                        // 오류 
                        alert(`오류 발생! 다시 시도하세요. ${status} - ${error}`);
                        console.error('Error:', status, error);
                    }
                })
            })
        })
        

    </script>
</body>
</html>